<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Baza Restauracji</title>
    <style>
        /* Tylko niezbędne ramki dla tabeli */
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 5px; text-align: left; }
    </style>
</head>
<body>

    <h3>Lista Restauracji</h3>

    <div>
        <input type="text" id="szukaj" placeholder="Nazwa restauracji...">
        <button onclick="filtruj()">Szukaj</button>
        <button onclick="resetuj()">Pokaż wszystkie</button>
    </div>
    <br>

    <div id="tabela">Ładowanie...</div>

    <script>
        let xmlDoc = null;

        // Pobranie pliku XML od razu po wejściu na stronę
        window.onload = function() {
            let xhr = new XMLHttpRequest();
            xhr.open("GET", "restaurants.xml", true);
            xhr.onload = function() {
                if (xhr.status === 200) {
                    xmlDoc = xhr.responseXML;
                    generujTabele(""); 
                }
            };
            xhr.send();
        };

        function filtruj() {
            let fraza = document.getElementById("szukaj").value;
            generujTabele(fraza);
        }

        function resetuj() {
            document.getElementById("szukaj").value = "";
            generujTabele("");
        }

        function generujTabele(tekst) {
            if (!xmlDoc) return;

            // Ustawienie ścieżki XPath (wszystko lub filtrowanie po nazwie)
            let sciezka = "/restaurants/restaurant";
            if (tekst !== "") {
                sciezka = "/restaurants/restaurant[contains(name, '" + tekst + "')]";
            }

            // Pobieranie danych z XML
            let wezly = xmlDoc.evaluate(sciezka, xmlDoc, null, XPathResult.ANY_TYPE, null);
            let wezel = wezly.iterateNext();
            
            let html = "<table><tr><th>Nazwa</th><th>Adres</th><th>Właściciel</th><th>Menu</th></tr>";
            let znaleziono = false;

            while (wezel) {
                znaleziono = true;
                
                // Wyciąganie prostych danych
                let nazwa = wezel.getElementsByTagName("name")[0].textContent;
                let wlasciciel = wezel.getElementsByTagName("owner")[0].textContent;
                
                // Składanie adresu w jeden ciąg
                let adr = wezel.getElementsByTagName("address")[0];
                let adresCalosc = adr.getElementsByTagName("street")[0].textContent + ", " +
                                  adr.getElementsByTagName("city")[0].textContent + " " +
                                  adr.getElementsByTagName("postal-code")[0].textContent;

                // Pętla do tworzenia listy menu
                let menuHtml = "<ul>";
                let dania = wezel.getElementsByTagName("item");
                for (let i = 0; i < dania.length; i++) {
                    menuHtml += "<li>" + dania[i].getElementsByTagName("name")[0].textContent + 
                                " (" + dania[i].getElementsByTagName("price")[0].textContent + " zł)</li>";
                }
                menuHtml += "</ul>";

                // Dodanie wiersza do tabeli HTML
                html += "<tr><td>" + nazwa + "</td><td>" + adresCalosc + "</td><td>" + wlasciciel + "</td><td>" + menuHtml + "</td></tr>";
                wezel = wezly.iterateNext();
            }

            html += "</table>";

            if (!znaleziono) html = "Brak wyników.";
            document.getElementById("tabela").innerHTML = html;
        }
    </script>
</body>
</html>
