<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Baza Restauracji</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; vertical-align: top; }
        th { background-color: #f4f4f4; }
        input { padding: 8px; width: 300px; }
        button { padding: 8px 15px; cursor: pointer; }
        ul { margin: 0; padding-left: 20px; }
    </style>
</head>
<body>

    <h1>Lista Restauracji</h1>

    <div>
        <input type="text" id="szukaj" placeholder="Wpisz nazwę restauracji...">
        <button onclick="filtruj()">Szukaj</button>
        <button onclick="resetuj()">Pokaż wszystkie</button>
    </div>

    <div id="tabela">Ładowanie danych...</div>

    <script>
        let xmlDoc = null;

        window.onload = function() {
            let xhr = new XMLHttpRequest();
            xhr.open("GET", "restaurants.xml", true);
            xhr.onload = function() {
                if (xhr.status === 200) {
                    xmlDoc = xhr.responseXML;
                    generujTabele(""); 
                }
            };
            xhr.send();
        };

        function filtruj() {
            let fraza = document.getElementById("szukaj").value;
            generujTabele(fraza);
        }

        function resetuj() {
            document.getElementById("szukaj").value = "";
            generujTabele("");
        }

        function generujTabele(tekst) {
            if (!xmlDoc) return;

            let sciezka = "/restaurants/restaurant";
            if (tekst !== "") {
                sciezka = "/restaurants/restaurant[contains(name, '" + tekst + "')]";
            }

            let wezly = xmlDoc.evaluate(sciezka, xmlDoc, null, XPathResult.ANY_TYPE, null);
            let wezel = wezly.iterateNext();
            
            let html = "<table><tr><th>Nazwa</th><th>Adres</th><th>Właściciel</th><th>Menu</th></tr>";
            let znaleziono = false;

            while (wezel) {
                znaleziono = true;
                
                let nazwa = wezel.getElementsByTagName("name")[0].textContent;
                let wlasciciel = wezel.getElementsByTagName("owner")[0].textContent;
                
                let adr = wezel.getElementsByTagName("address")[0];
                let adresCalosc = adr.getElementsByTagName("street")[0].textContent + ", " +
                                  adr.getElementsByTagName("city")[0].textContent + " " +
                                  adr.getElementsByTagName("postal-code")[0].textContent + " (" +
                                  adr.getElementsByTagName("country")[0].textContent + ")";

                let menuHtml = "<ul>";
                let dania = wezel.getElementsByTagName("item");
                for (let i = 0; i < dania.length; i++) {
                    menuHtml += "<li>" + dania[i].getElementsByTagName("name")[0].textContent + 
                                " - " + dania[i].getElementsByTagName("price")[0].textContent + " zł</li>";
                }
                menuHtml += "</ul>";

                html += "<tr><td><b>" + nazwa + "</b></td><td>" + adresCalosc + "</td><td>" + wlasciciel + "</td><td>" + menuHtml + "</td></tr>";
                wezel = wezly.iterateNext();
            }

            html += "</table>";

            if (!znaleziono) html = "<p>Brak wyników.</p>";
            document.getElementById("tabela").innerHTML = html;
        }
    </script>
</body>
</html>
